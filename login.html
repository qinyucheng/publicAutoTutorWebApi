<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>


<link href="css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="css/H-ui.login.css" rel="stylesheet" type="text/css" />
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link href="lib/Hui-iconfont/1.0.6/iconfont.css" rel="stylesheet" type="text/css" />

<title>Login</title>
<meta name="keywords" content="">
<meta name="description" content="">
</head>
<body>
<input type="hidden" id="TenantId" name="TenantId" value="" />
<div class="header"></div>
<div class="loginWraper">
  <div id="loginform" class="loginBox">
      <div class="form form-horizontal" id="loginForm" name="loginForm"  onsubmit="return login();">
          <div class="row cl">
              <label class="form-label col-3"><i class="Hui-iconfont">&#xe60d;</i></label>
              <div class="formControls col-8" >
                  <input name="Email" id="Email" type="text" placeholder="Email" class="input-text size-L" autocomplete="off">
              </div>
           
          </div>
          <div class="row cl">
              <label class="form-label col-3"><i class="Hui-iconfont">&#xe60e;</i></label>
              <div class="formControls col-8">
                  <input name="Password" id="Password" type="password" placeholder="Password" class="input-text size-L" autocomplete="off"> 
              </div>
          </div>

          <div class="row">
              <div class="formControls col-8 col-offset-3">
                  <label for="online">
                      <input type="checkbox" value="remember-me" id="remember_me" name="online">
                    
                      Remember me
                  </label>
              </div>
          </div>
          <div class="row">
              <div class="formControls col-8 col-offset-3">
                  <input name="" type="submit" class="btn btn-success radius size-L" value="&nbsp;Login" onclick="login()">

              </div>
          </div>

      </div>
      <div class="row">
          <div class="formControls col-8 col-offset-3">
              <input name="" type="submit" class="btn btn-success radius size-L" value="&nbsp;Try a Lesson First!" onclick="changeToVisitorTryPage()">

          </div>
      </div>
      <div class="row">
          <div class="formControls col-8 col-offset-3">
              <a data-title="Admin List" href="javascript:changeToRegForm()">Create account</a>
          </div>
          <div class="formControls col-8 col-offset-3">
              <a data-title="Admin List" href="javascript:changeTORestPassword()">Forget password</a>
          </div>
      </div>
  </div>
    <div id="regForm" class="regBox">
        <div class="form form-horizontal" id="loginForm" name="loginForm" onsubmit="return login();">
            <div class="row cl">
                <label class="form-label col-3"><i class="Hui-iconfont">&#xe60d;</i></label>
                <div class="formControls col-8 ">
                    <input name="fName" id="fName" type="text" placeholder="First Name" class="input-text size-L" autocomplete="off">
                    <div class="col-4 errorMSG" id="divfName" style="width:300px"></div>
                </div>
               
            </div>
            <div class="row cl">
                <label class="form-label col-3"><i class="Hui-iconfont"></i></label>
                <div class="formControls col-8">
                    <input name="lName" id="lName" type="text" placeholder="Last Name" class="input-text size-L" autocomplete="off">
                    <div class="col-4 errorMSG" id="divlName" style="width:300px"></div>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-3"><i class="Hui-iconfont">&#xe63b;</i></label>
                <div class="formControls col-8">
                    <input name="regEmail" id="regEmail" type="text" placeholder="Email" class="input-text size-L" autocomplete="off">
                    <div class="col-4 errorMSG" id="divregEmail" style="width:300px"></div>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-3"><i class="Hui-iconfont">&#xe696;</i></label>
                <div class="formControls col-8">
                    <input name="regPhone" id="regPhone" type="text" placeholder="Phone Nomber" class="input-text size-L" autocomplete="off">
                    <div class="col-4 errorMSG" id="divregPhone" style="width:300px"></div>
                </div>
                
            </div>
            <div class="row cl">
                <label class="form-label col-3"><i class="Hui-iconfont">&#xe60e;</i></label>
                <div class="formControls col-8">
                    <input name="regPassword" id="regPassword" type="password" placeholder="Password" class="input-text size-L" autocomplete="off">
                    <div class="col-4 errorMSG" id="divregPassword" style="width:300px"></div>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-3"><i class="Hui-iconfont"></i></label>
                <div class="formControls col-8">
                    <input name="regRePassword" id="regRePassword" type="password" placeholder="Re-enter password" class="input-text size-L" autocomplete="off">
                    <div class="col-4 errorMSG" id="divregRePassword" style="width:300px"></div>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-3"><i class="Hui-iconfont">&#xe602;</i></label>
                <div class="formControls col-5 skin-minimal">
                    <div class="radio-box">
                        <input type="radio" name="role" id="regTeacher" value="Teacher" checked>
                        <label>Teacher</label>
                    </div>
                    <div class="radio-box">
                        <input type="radio" name="role" id="regUser" value="User">
                        <label>User</label>
                    </div>
                </div>
                <div class="col-4"> </div>
            </div>
         
            <div class="row">
                <div class="formControls col-8 col-offset-3">
                    <input name="" type="submit" class="btn btn-success radius size-L" value="&nbsp;Sign Up" onclick="registration()">

                </div>
            </div>

        </div>
        <div class="row">
            <div class="formControls col-8 col-offset-3">
                <a data-title="Admin List" href="javascript:changeToLoginForm()">Return to Log In</a>
            </div>
        </div> 
    </div>


    <div id="forgetPwd" class="forgetPwd">
        <div class="form form-horizontal">
            <div class="row cl">
                <label class="form-label col-3"><i class="Hui-iconfont">&#xe63b;</i></label>
                <div class="formControls col-8">
                    <input name="emailAddress" id="emailAddress" type="text" placeholder="Input your email to reset your password" class="input-text size-L" autocomplete="off">
                    <div class="col-4 errorMSG" id="userEmail" style="width:300px"></div>
                </div>
            </div>
            <div class="row">
                <div class="formControls col-8 col-offset-3">
                    <input name="" type="submit" class="btn btn-success radius size-L" value="&nbsp;Send Email" onclick="resetPassword()">
                </div>
            </div>
         </div>
            <div class="row">
                <div class="formControls col-8 col-offset-3">
                    <a data-title="Admin List" href="javascript:changeToLoginForm()">Return to Log In</a>
                </div>
            </div>
        </div>
</div>
<div class="footer"></div>
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="js/H-ui.js"></script> 
<script type="text/javascript" src="js/jquery.cookie.js"></script> 
<script type="text/javascript" src="js/jquery.md5.js"></script>
<script type="text/javascript" src="js/serverUrl.js"></script>
<script>
    var statusEmail = false;
    $(document).ready(function () {
        $('#regForm').hide();
        $('#forgetPwd').hide();
        var cookies = $.cookie();
        for (var cookie in cookies) {
            $.removeCookie(cookie);
        }
      
       
        $(function () {

            if (localStorage.chkbx && localStorage.chkbx != '') {
                $('#remember_me').attr('checked', 'checked');
                $('#Email').val(localStorage.usrname);
                $('#Password').val(localStorage.pass);
            } else {
                $('#remember_me').removeAttr('checked');
                $('#Email').val('');
                $('#Password').val('');
            }

            $('#remember_me').click(function () {

                if ($('#remember_me').is(':checked')) {
                    // save username and password
                    localStorage.usrname = $('#Email').val();
                    localStorage.pass = $('#Password').val();
                    localStorage.chkbx = $('#remember_me').val();
                } else {
                    localStorage.usrname = '';
                    localStorage.pass = '';
                    localStorage.chkbx = '';
                }
            });
        }); 
    });

    function clearInputBox()
    {
        $(':input')
            .not(':button, :submit, :reset, :hidden')
            .val('');

    }
   
    function changeToRegForm() {
        clearInputBox();
        $('#loginform').hide();
        $('#regForm').show();
        
    }
  
    function changeToLoginForm()
    {
        clearInputBox();
        $('#loginform').show();
        $('#regForm').hide();
        $('#forgetPwd').hide();
    }

    function changeToVisitorTryPage()
    {
        window.location = "visitorTry.html";
    }

    function isValidMail(email) {
        var patten = new RegExp(/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]+$/);
        return patten.test(email);
    }


    //check if email aready exist in database
    function uniqueUserEmail(email) {
        method = "GET";
        Url = serverUrl + '/api/MongoDB';
        $.ajax({
            async: false,
            url: Url,
            type: method,
            dataType: 'json',
            data: "",

        }).success(function (data) {
            $.each(data, function (index, user) {
                if (user["Email"] === email) {
                    $("#divregEmail").find("span").remove();
                    //$("#divregEmail").css("width", "+=100");
                    $('<span class="Validform_checktip Validform_wrong"></span>').html("This email address already registed!").appendTo('#divregEmail');
                    $("#regEmail").focus();
                    //alert("This email already register!");
                    statusEmail = true;
                    return statusEmail;
                }
                else {
                    $("#divregEmail").find("span").remove();
                }

            });
            return statusEmail;
        });

    }


    function login()
    {
        var email = $('#Email').val();
        var password =$('#Password').val();
        if (email != "") {
            var result = isValidMail(email);
            if (result == false) {
                alert("Please Check your Email Format!")
                return;
            }
           
        }
        else
        {
            alert("Email cannot be blank!!")
            return;
        }
        if(password==""){
            alert("Password cannot be blank!")
            return;
        }	
        password = $.md5(password);
        method = "GET";
        Url = serverUrl+'/api/MongoDB';
        content = { Email: email, Password: password };
        $.ajax({

            url: Url,
            type: method,
            data: content,

        }).success(function (data) {
            myStorage = localStorage;
            var isEmptyObject = jQuery.isEmptyObject(data);
            if (isEmptyObject == false) {
                    
                if (data.Status == "inactive" && data.Role=="User") {
                    alert("Your account has locked. Please contect administrator to Unlock your account!");
                    return;
                }
                else {
                    $('#Email').val('');
                    $('#Password').val('');
                    localStorage.setItem('PersonInfo', JSON.stringify(data));
                    localStorage.setItem('isLogin', true);

                    window.location.href = "index.html";
                }
                  
                  
            }
            else {
                alert("Please check your Account or Password!")
                  
                //window.location.replace("login.html");
                // clearInputBox();
                  
            }

        });

    }
        function registration()
        {
            $(".errorMSG").empty();
            var FirstName = $('#fName').val();
            var LastName = $('#lName').val();
            var Email = $('#regEmail').val().toLowerCase();;
            var Phone = $('#regPhone').val();
            var Role = $('input[name="role"]:checked').val();
            var Password = $('#regPassword').val();
            var rePassword =$('#regRePassword').val();
            if (FirstName == "") {             
                $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divfName');

                $("#fName").focus();
                return;
            }
            if (LastName == "") {
                $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divlName');

                $("#lName").focus();
                return;
            }
            if (Email != "") {
                var result = isValidMail(Email);
                if (result == false) {   
                    $('<span class="Validform_checktip Validform_wrong"></span>').html("Please Check your Email Format!").appendTo('#divregEmail');
                    $("#regEmail").focus();
                    return;
                }
                if (statusEmail == true) {
                    $('<span class="Validform_checktip Validform_wrong"></span>').html("This email address already registed!").appendTo('#divregEmail');
                    return;
                }
            }
            else {
                var divregEmail=$("#divregEmail");
                $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divregEmail');
                $("#regEmail").focus();
                return;
            }
            $("#divregEmail").find("span").remove();
            if (Phone == "") {
                $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divregPhone');
                $("#regPhone").focus();
                return;
            }
            else {
                var phoneRe = /^[(]{0,1}[0-9]{3}[)]{0,1}[-\s\.]{0,1}[0-9]{3}[-\s\.]{0,1}[0-9]{4}$/;
                if (Phone.match(phoneRe)===null) {
                    $('<span class="Validform_checktip Validform_wrong"></span>').html("Phone number format is not correct!").appendTo('#divregPhone');
                    return;
                }
            }


            if (Password == "") {         
                $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divregPassword');
                $("#regPassword").focus();
                return;
            }

            if (Password.length < 6 || Password.length > 12) {
                $("#divregPassword").find("span").remove();
                $('<span class="Validform_checktip Validform_wrong"></span>').html("Password should be in 6 to 12 characters").appendTo('#divregPassword');
                //alert("password should be in 6 to 12 characters")
                validPassWord = false;
            }
            else {
                $("#divregPassword").find("span").remove();
                validPassWord = true;
            }


            if (!validPassWord) {
                return;
            }
            if (Password != rePassword)
            {
                $('<span class="Validform_checktip Validform_wrong"></span>').html("Your password do not march!").appendTo('#divregRePassword');
                $("#regRePassword").focus();
                return;
            }
            if (Role == "Teacher")
            {
                Status = "inactive";
            }
            else if (Role == "User")
            {
                Status = "active";
            }
            Password = $.md5(Password);
            
            content = { 'FirstName': FirstName, 'LastName': LastName, 'Email': Email, 'Phone':Phone, 'Password': Password, 'Status': Status, 'Role': Role };
            method = "POST";
             Url = serverUrl+'/api/MongoDB';

            $.ajax({

                url: Url,
                type: method,
                data: content,

            }).success(function (data) {
           
                if (data == true) {
                    localStorage.setItem('PersonInfo', JSON.stringify(content));
                    localStorage.setItem('isLogin', true);
                    window.location.href = "index.html";
                }
                else {
                    clearInputBox();
  
                }

            });
    
        }

           var validPassWord;
           $("#regPassword").blur(function () {
               var val = $(this).val();
               if (val.length < 6 || val.length > 12) {
                   $("#divregPassword").find("span").remove();            
                   $('<span class="Validform_checktip Validform_wrong"></span>').html("Password should be in 6 to 12 characters").appendTo('#divregPassword');
                   //alert("password should be in 6 to 12 characters")
                   validPassWord=false;
               }
               else {
                   $("#divregPassword").find("span").remove();
                   validPassWord = true;
               }
           });


    //yehui blur function for check email address
           $("#regEmail").blur(function () {
               var Email = $('#regEmail').val().toLowerCase();;
               uniqueUserEmail(Email);
           });


           function changeTORestPassword() {
               clearInputBox();
               $('#loginform').hide();
               $('#forgetPwd').show();
           }

           function resetPassword() {
               var getPasswordEmail=$("#emailAddress").val().toLowerCase();
               if (getPasswordEmail != "") {
                   var result = isValidMail(getPasswordEmail);
                   if (result == false) {
                       $("#userEmail").find("span").remove();
                       $('<span class="Validform_checktip Validform_wrong"></span>').html("Please Check your Email Format!").appendTo('#userEmail');                     
                       return;
                   }
               }
               else {
                   $("#userEmail").find("span").remove();
                   $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#userEmail');
                   return;
               }
               $("#userEmail").find("span").remove();

               var method = "PUT";
               content = { "Email": getPasswordEmail };
               Url = serverUrl + '/api/ChangePassword';
               $.ajax({

                   url: Url,
                   type: method,
                   data: content,

               }).success(function (data) {
                   if (data == true) {
                       alert("please check your email to get your temporal password");
                   }
                   else
                       alert("please submit your email again");
                       $("#emailAddress").val("");

               });
           }
</script>
</body>
</html>