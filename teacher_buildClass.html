<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<LINK rel="Bookmark" href="/favicon.ico" >
<LINK rel="Shortcut Icon" href="/favicon.ico" />

<link href="css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link href="lib/Hui-iconfont/1.0.7/iconfont.css" rel="stylesheet" type="text/css" />
<link href="css/normalize.css" rel="stylesheet"/>
<link href="css/jquery-ui.css" rel="stylesheet"/>
<link href="css/jquery.idealforms.min.css" rel="stylesheet" media="screen"/>
 <style>
     .idealsteps-step {
         display:none;
     }
     .ideal-wrap {
         position:relative;

         //left:18%;
     }
     .ideal-tabs-wrap {    
        width:100%;    
       //width:675px;
        position: relative;
        left:25%;
     }
     #reviseStudentInfo {
         display:none;
     }
     #cancelRevise {
         display:none;
     }
     #displayUrl {
         display:none;
     }
     #doneButton {
          display:none;
     }

  </style>

<title>Teacher add a class</title>
</head>
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i>Teacher add a class <a class="btn btn-success radius r mr-20" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="refresh" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>

<section id="displayUrl">
    <div class="pd-20">
        <table class="table table-border table-bordered table-bg" id="url" align="center">
            <thead>
                <tr>
                    <th scope="col" colspan="9">Study URL</th>
                </tr>
            </thead>

        </table>
    </div>
</section>

<div class="ideal-wrap ideal-tabs ideal-full-width">
    <div style="width:60%">
        <ul class="ideal-tabs-wrap">
            <li class="ideal-tabs-tab ideal-tabs-tab-active" id="step1"><span>step 1-Class information</span><i class="ideal-tabs-tab-counter">1</i></li>

            <li class="ideal-tabs-tab" id="step2"><span>step 2-Select lessons</span><i class="ideal-tabs-tab-counter">2</i></li>

            <li class="ideal-tabs-tab" id="step3"><span>step 3-Add students</span><i class="ideal-tabs-tab-counter">3</i></li>

            <li class="ideal-tabs-tab" id="step4"><span>step 4-Confirm</span><i class="ideal-tabs-tab-counter">4</i></li>
        </ul>
    </div>
</div>

<!--fill class information-->
<section id ="classInfo" name="step 1-Class information" class="idealsteps-step">
    <div class="pd-20">
        <div class="form form-horizontal">
            <div class="row cl">
                <label class="form-label col-3"><span class="c-red">*</span>Teacher Email:</label>
                <div class="formControls col-5">
                    <input type="text" class="input-text" placeholder="Email" name="email" id="email" datatype="e" nullmsg="">
                </div>
                <div class="col-4"> </div>
            </div>

            <div class="row cl">
                <label class="form-label col-3"><span class="c-red">*</span>Class Name:</label>
                <div class="formControls col-5" id="divClassname">
                    <input type="text" class="input-text" value="" placeholder="Unique name" id="className" name="user-name" datatype="*2-16" nullmsg="Student ID can not be null!">
                </div>
                <div class="col-4"> </div>
            </div>
            <div class="row cl">
                <label class="form-label col-3"><span class="c-red">*</span> Class period:</label>
                <div class="formControls col-5" id="dateTime">
                    <input type="text" onfocus="WdatePicker({ minDate: '#F{$dp.$D(\'datemin\')}', minDate: '%M-%d-%y' })" id="datemax" class="input-text Wdate" style="width:120px;">
                    ---
                    <input type="text" onfocus="WdatePicker({ minDate: '#F{$dp.$D(\'datemax\')||\'%M-%d-%y\'}' })" id="datemin" class="input-text Wdate" style="width:120px;">
                 
                </div>
                <div class="col-4"> </div>
            </div>
            <div class="row cl">
                <label class="form-label col-3"><span class="c-red">*</span>Lesson Group:</label>
                <div class="formControls col-5">
                    <select id="group">
                    </select>
                </div>
                <div class="col-4"> </div>
            </div>

            <div class="cl pd-5 bg-1 bk-gray mt-20">
                <span class="r">
                    <!--<button class="btn btn-success" type="submit" id="createClass">Create a Class</button>-->
                    <button class="btn btn-success" type="submit" id="first_next">Next</button>
                </span>
            </div>
        </div>
    </div>
        <br /><br /><br />
</section>

<!--section for display and select lessons-->
<section id ="lessonInfo" name="step 2-Select lessons" class="idealsteps-step">
    <div class="pd-20">
        <table class="table table-border table-bordered table-bg" id="lessonsTable" align="center">
            
        </table>
        <div class="cl pd-5 bg-1 bk-gray mt-20">
            <span class="r">
                <button class="btn btn-success" type="submit" id="first_back">Previous</button>
                <button class="btn btn-success" type="submit" id="second_next">Next</button>
            </span>
        </div>
    </div>
</section>

<!--section for add students-->
<section id="studentList" name="step 3-Add students" class="idealsteps-step">
<div class="pd-20">
	<table class="table table-border table-bordered table-bg" id="studentTable">
		<thead>
			<tr>
				<th scope="col" colspan="9">Student List</th>
			</tr>
			<tr class="text-c">
				<th width="40">Student ID</th>
				<th width="150">Student Name</th>
				<th width="90">Student Email</th>
				<th width="100">Operations</th>
			</tr>
		</thead>
        <tbody>
        </tbody>
    </table>

<br/><br/><br/>
	<div class="form form-horizontal">
		<div class="row cl">
			<label class="form-label col-3"><span class="c-red">*</span>Student ID:</label>
            <div class="formControls col-4" id="divStudnetID">
                <input type="text" class="input-text" value="" placeholder="Unique ID" id="studentID" name="studentID" datatype="*2-16" nullmsg="Student ID can not be null!">
            </div>
			<div class="col-4"> </div>
		</div>
		<div class="row cl">
			<label class="form-label col-3"><span class="c-red">*</span>StudentName：</label>
            <div class="formControls col-4" id="divStudnetName">
                <input type="text" placeholder="Name" autocomplete="off" value="" class="input-text" datatype="*6-20" nullmsg="" name="studentName" id="studentName">
            </div>
			<div class="col-4"> </div>
		</div>
		<div class="row cl">
			<label class="form-label col-3">Student Email:</label>
            <div class="formControls col-4" id="divStudentEmail">
                <input type="text" class="input-text" placeholder="Email" name="studentEmail" id="studentEmail" datatype="e" nullmsg="">
            </div>
			<div class="col-4"> </div>
		</div>
		<div class="row cl">
			<div class="col-9 col-offset-3">
				<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;Add a new student&nbsp;&nbsp;" id="addStudent">
			</div>
		</div>
        <div class="row cl">
            <div class="col-9 col-offset-3">
                <input class="btn btn-primary radius" type="submit" value="&nbsp;Cancel&nbsp;" id="cancelRevise">
                <input class="btn btn-primary radius" type="submit" value="&nbsp;revise student info&nbsp;" id="reviseStudentInfo">
            </div>
        </div>
        <div class="cl pd-5 bg-1 bk-gray mt-20">
            <span class="r">
                <button class="btn btn-success" type="submit" id="second_back">Previous</button>
                <button class="btn btn-success" type="submit" id="third_next">Next</button>
            </span>
        </div>
	</div>
</div>

	<br/><br/><br/>
	</section>

	<!--section for review all information-->
	<section id ="confirm" name="step 4-Confirm" class="idealsteps-step">
        <div class="pd-20">
        <table class="table table-border table-bordered table-bg" id="confirmClass" align="center">
        </table>
		<br/>
        <table class="table table-border table-bordered table-bg" id="confirmLesson" align="center">
        </table>
		<br/>
        <table class="table table-border table-bordered table-bg" id="confirmStudent" align="center">
        </table>
        <div class="cl pd-5 bg-1 bk-gray mt-20" id="submitBtn">
            <span class="r">
                <button class="btn btn-success" type="submit" id="third_back">Previous</button>
                <button class="btn btn-success" type="submit" id="confirmBT">Submit</button>
            </span>
        </div>
            <div class="cl pd-5 bg-1 bk-gray mt-20" id="doneButton">
                <span class="r">
                    <button _href='teacher_MyClass.html' href='javascript:void(0)' data-title='My Classes' onclick='CloseThisTab()' class="btn btn-success" type="submit">Done!</button>
                </span>
            </div>
    </div>
	</section>

<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>  
<script type="text/javascript" src="lib/layer/2.1/layer.js"></script> 
<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script> 
<script type="text/javascript" src="lib/My97DatePicker/WdatePicker.js"></script> 
<script type="text/javascript" src="js/H-ui.js"></script> 
<script type="text/javascript" src="js/H-ui.admin.js"></script> 
<script type="text/javascript" src="lib/Validform/5.3.2/Validform.min.js"></script> 
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/jquery.idealforms.js"></script>
<script type="text/javascript" src="js/lessonGroupList.js"></script>



<script type="text/javascript">

function admin_del(obj, id) {
    flag = 1;
    var studentID = $(obj).parents("tr").children("td")[0].innerHTML;
    layer.confirm('Do you want to delete this student？', function (index) {

		$(obj).parents("tr").remove();
		layer.msg('deleted!', { icon: 1, time: 1000 });
		$.each(student, function (index, student) {
		    if (studentID === student["StudentID"]) {
		        studentsList.splice(index, 1);
		        return false;
		    }
		}
);
	});
}
function CloseThisTab() {
   
    closeTab("#buildClass");

}


$("#step1").click(function () {
    if (step[0] === true) {
        $("#"+tabId).attr("class", "ideal-tabs-tab");
        $("#step1").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
        $(nameMap[tabId]).hide();
        $(nameMap["step1"]).show();

        tabId = $(this).attr("id");
    }
});

$("#step2").click(function () {
    if (step[1] === true) {
        $("#"+tabId).attr("class", "ideal-tabs-tab");
        $("#step2").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
        $(nameMap[tabId]).hide();
        $(nameMap["step2"]).show();

        tabId = $(this).attr("id");   
    }
});
$("#step3").click(function () {
    if (step[2] === true) {
        $("#" + tabId).attr("class", "ideal-tabs-tab");
        $("#step3").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
        $(nameMap[tabId]).hide();
        $(nameMap["step3"]).show();
       

        tabId = $(this).attr("id");
    }
});
$("#step4").click(function () {
    if (step[3] === true) {
        $("#" + tabId).attr("class", "ideal-tabs-tab");
        $("#step4").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
        $(nameMap[tabId]).hide();
        $(nameMap["step4"]).show();

        tabId = $(this).attr("id");
        clearnConfirmTable();
        confirmST();
        confirmCS();
        confirmLessonInfo();
    }
});




//control sections hide or show

//$(".idealsteps-step").hide();
$("#classInfo").show();

$("#first_next").click(function(){
    groupName = $("#group option:selected").text();
    createClass();
});
$("#second_next").click(function () {
    if (lessonInformation.length === 0) {
        alert("Please select lessons");
        return;
    }
	$("#lessonInfo").hide();
	$("#studentList").show();
	$("#step2").attr("class","ideal-tabs-tab");
	$("#step3").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
	step[2] = true;
	tabId = "step3";
	classInformation["SeletedLeassons"] = lessonInformation;
	putLessonInfo();
});
$("#third_next").click(function () {
    if (studentsList.length === 0) {
       alert("You should add at least one student")
       return;
    }
	$("#studentList").hide();
	$("#confirm").show();
	$("#step3").attr("class","ideal-tabs-tab");
	$("#step4").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
	step[3] = true;
	tabId = "step4";
	classInformation["StudentGroup"] = studentsList;
	putStudentInfo();        //put function
    confirmST();
    confirmCS();
    confirmLessonInfo();
});
$("#third_back").click(function(){
	$("#studentList").show();
	$("#confirm").hide();
	$("#step4").attr("class","ideal-tabs-tab");
	$("#step3").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
	tabId = "step3";
	clearnConfirmTable();
});
$("#second_back").click(function(){
	$("#studentList").hide();
	$("#lessonInfo").show();
	$("#step3").attr("class","ideal-tabs-tab");
	$("#step2").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
	tabId = "step2";
});
$("#first_back").click(function(){
	$("#classInfo").show();
	$("#lessonInfo").hide();
	$("#step2").attr("class","ideal-tabs-tab");
	$("#step1").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
	tabId = "step1";
});

function clearnConfirmTable() {   
    $("#confirmClass thead").remove();
    $("#confirmClass tr").remove();
    $("#confirmLesson thead").remove();
    $("#confirmLesson tr").remove();
    $("#confirmStudent thead").remove();
    $("#confirmStudent tr").remove();
}

//$(function(){
    //displayLessons();
   
//});
//get lesson function
function displayLessons() {
    method = "GET";
    content = { id: "status", status: "active" };
    Url = '/api/Lessons';
    $.ajax({

        url: Url,
        type: method,
        dataType: 'json',
        data: content,

        success: function (data) {
            console.log(".net Output:");
            $("#lessonsTable").append("<thead><tr><th scope='col' colspan='9'>Lesson List</th></tr><tr class='text-c'><th width='25'></th><th width='40'>Lesson ID</th><th width='40'>Lesson Name</th><th width='150'>Description</th><td width='25'></td><th width='25'></th><th width='40'>Lesson ID</th><th width='40'>Lesson Name</th><th width='150'>Description</th></tr></thead>");
            var countNO = 0;            
            var lessonArray=[];
            var i;
            lessonObj = data;
            $.each(data, function (index, array) { //loop  items for display
                if (array['LessonGroup'] == groupName && array['Status'] === "active") {
                    lessonArray.push(array);
                }
            });
            var length = lessonArray.length;

            for (i=0; i <length-1; i=+ 2) {
                $("#lessonsTable").append("<tr align='center' class='text-c'><td><input type='checkbox' value='1' name=''></td><td>" + lessonArray[i]['LessonID'] + "</td><td id=" + lessonArray[i]['LessonID'] + " >" + lessonArray[i]['LessonName'] + "</td><td>" + lessonArray[i]['Description'] + "</td><td width='25'></td><td><input type='checkbox' value='1' name=''></td><td>" + lessonArray[i + 1]['LessonID'] + "</td><td id=" + lessonArray[i + 1]['LessonID'] + " >" + lessonArray[i + 1]['LessonName'] + "</td><td>" + lessonArray[i + 1]['Description'] + "</td></tr>");
            }
            if (length - 1 == i) {
                $("#lessonsTable").append("<tr align='center' class='text-c'><td><input type='checkbox' value='1' name=''></td><td>" + lessonArray[i]['LessonID'] + "</td><td id=" + lessonArray[i]['LessonID'] + " >" + lessonArray[i]['LessonName'] + "</td><td>" + lessonArray[i]['Description'] + "</td><td width='25'></td><td></td><td></td><td></td><td></td></tr>");
            }
        },


        complete: function () { //
            $('td > input', $('#lessonsTable')).click(function () {
                $('.selected').removeClass('selected');
                $(this).addClass('selected'); //this 
                var $td = $(this).parents('td').next();
                var LessonID = $td[0].innerHTML;
                selectedID = $td.id;
                if ($(this).is(":checked")) {
                    $.each(lessonObj, function (index, array) {
                        if (LessonID === array["LessonID"]) {
                            var oneLesson = { "LessonID": array["LessonID"], "LessonName": array["LessonName"], "Description": array["Description"], "ScriptURL": array["ScriptURL"], "LessonURL": array["LessonURL"] };
                            lessonInformation.push(oneLesson);
                            return false;
                        }
                        }   
                    );
                }
                else {
                    $.each(lessonInformation, function (index, lesson) {
                        if (LessonID === lesson["LessonID"]){
                            lessonInformation.splice(index, 1);
                            return false;
                        }
                        }
                    );
                }

            }).hover(		//
                   function () {
                       $(this).addClass('mouseOver');
                   },
                   function () {
                       $(this).removeClass('mouseOver');
                   }
               );

        },

    });
}


    // reviseStudentInfo button click event
$('#reviseStudentInfo').click(function () {

    var studentID  = document.getElementById("studentID").value;
    var studentName = document.getElementById("studentName").value;
    var studentEmail = document.getElementById("studentEmail").value;

    if (studentID === "") {
        $("#divStudnetID").find("span").remove();
        $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divStudnetID');
        return;
    }
    $("#divStudnetID").find("span").remove();
    if (studentName === "") {
        $("#divStudnetName").find("span").remove();
        $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divStudnetName');
        return;
    }
    $("#divStudnetName").find("span").remove();


    if (studentEmail != "") {
        var result = isValidMail(studentEmail);
        if (result == false) {
            $("#divStudentEmail").find("span").remove();
            $('<span class="Validform_checktip Validform_wrong"></span>').html("Email format is not correct!").appendTo('#divStudentEmail');
            return;
        }
        //alert("email address!")
    }
    else {

    }

    $("#divStudentEmail").find("span").remove();

    if (checkStudentIdExitExcept(studentID, selectStud)) {
        
    }
    else {
        $("#divStudnetID").find("span").remove();
        $('<span class="Validform_checktip Validform_wrong"></span>').html("studnetId is exit!").appendTo('#divStudnetID');
        return;
    }

    $("#divStudnetID").find("span").remove();
    $("#divStudnetName").find("span").remove();
    $("#divStudentEmail").find("span").remove();

    $.each(studentsList, function (index, selectStudent) {
        if (selectStud[0].innerHTML === selectStudent["StudentID"]) {
            studentsList[index]["StudentID"] = studentID;
            studentsList[index]["StudentName"] = studentName;
            studentsList[index]["StudentEmail"] = studentEmail;
            return false;
            }
        }
    );
    selectStud[0].innerHTML = studentID;
    selectStud[1].innerHTML = studentName;
    selectStud[2].innerHTML = studentEmail;
    $('#studentID').val('');
    $('#studentName').val('');
    $('#studentEmail').val('');
    $('#addStudent').show();
    $('#reviseStudentInfo').hide();
    $('#cancelRevise').hide();
});

    // cancel revise student infor
$('#cancelRevise').click(function () {
    $('#reviseStudentInfo').hide();
    $('#cancelRevise').hide();
    $('#addStudent').show();
    $('#studentID').val('');
    $('#studentName').val('');
    $('#studentEmail').val('');  
});

//add new student in the student table
$("#addStudent").click(function () {
    var student = {};
    var studentID = student["StudentID"] = document.getElementById("studentID").value;
    var studentName = student["StudentName"] = document.getElementById("studentName").value;
    var studentEmail = student["StudentEmail"] = document.getElementById("studentEmail").value;

    if (studentID === "") {
        $("#divStudnetID").find("span").remove();
        $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divStudnetID');
        return;
    }
    $("#divStudnetID").find("span").remove();

    if (studentName === "") {
        $("#divStudnetName").find("span").remove();
        $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divStudnetName');
        return;
    }
    $("#divStudnetName").find("span").remove();

    if (studentEmail != "") {
        var result = isValidMail(studentEmail);
        if (result == false) {
            $("#divStudentEmail").find("span").remove();
            $('<span class="Validform_checktip Validform_wrong"></span>').html("Email format is not correct!").appendTo('#divStudentEmail');
            return;
        }
        //alert("email address!")
    }
    else {//email equal empty

    }
    $("#divStudentEmail").find("span").remove();

  
    student["ID"] = teacherName + "-" + classInformation["ClassName"] + "-" + studentID;                        

    if (checkStudentIdExit(studentID)) {
        studentsList.push(student);
        $("#studentTable").append("<tr align='center' class='text-c'><td>" + studentID + "</td><td>" + studentName + "</td>" + "<td>" + studentEmail + "</td>" + "<td class='td-manage' id='delete'><a title='delete' href='javascript:;' " + "onclick=\"admin_del(this,'1')\"" + "class='ml-5' style='text-decoration:none'><i class='Hui-iconfont'>&#xe6e2;</i></a></td>" + "</tr>");
    }
    else {
        $("#divStudnetID").find("span").remove();
        $('<span class="Validform_checktip Validform_wrong"></span>').html("studnetId is exit!").appendTo('#divStudnetID');
        return;
    }

    $("#divStudnetID").find("span").remove();
    $("#divStudnetName").find("span").remove();
    $("#divStudentEmail").find("span").remove();
    $('#studentID').val('');
    $('#studentName').val('');
    $('#studentEmail').val('');
    $('tbody > tr', $('#studentTable')).click(function () {
        if (flag === 0) {
            $('.selected').removeClass('selected');
            $(this).addClass('selected'); //this 
            //var $td = $(this).children('td')[1];
            selectStud = $(this).children('td');
            //selectedID = $td.id;
            $('#studentID').val(selectStud[0].innerHTML);
            $('#studentName').val(selectStud[1].innerHTML);
            $('#studentEmail').val(selectStud[2].innerHTML);

            $('#addStudent').hide();
            $('#reviseStudentInfo').show();
            $('#cancelRevise').show();
        }
        else {
            flag = 0;
        }
    }).hover(		//
                   function () {
                       $(this).addClass('mouseOver');
                   },
                   function () {
                       $(this).removeClass('mouseOver');
                   }
               );
});

function checkStudentIdExit(studentID) {
    var bool=true;
    $.each(studentsList, function (index, student) {
        if (student["StudentID"] === studentID){
            bool=false
            return false
        }
    });
    return bool;
}



function checkStudentIdExitExcept(studentID, reviseBTN) {
    var bool = true;
    $.each(studentsList, function (index, student) {
        if (student["StudentID"] === reviseBTN[0].innerHTML) {
            return true;
        }
        if (student["StudentID"] === studentID) {
            bool = false
            return false
        }
    });
    return bool;
}


    // click createClass button
function createClass() {
    var dt = new Date();
    var time = dt.getFullYear().toString() + (dt.getMonth() + 1) + dt.getDate() + dt.getHours() + dt.getMinutes() + dt.getSeconds();
    if (signForPut != true){
        classInformation["_id"] = document.getElementById("className").value+"_" + time;
    }
    classInformation["ClassName"] = document.getElementById("className").value;
    classInformation["TeacherEmail"] = document.getElementById("email").value;
    classInformation["StudyStartTime"] = document.getElementById("datemax").value;
    classInformation["StudyEndTime"] = document.getElementById("datemin").value;
    classInformation["LessonGroup"] = groupName;
    
    if (document.getElementById("className").value === "") {
        $("#divClassname").find("span").remove();
        $('<span class="Validform_checktip Validform_wrong"></span>').html("You must fill this field!").appendTo('#divClassname');
        return;
    }
    $("#divClassname").find("span").remove();

    if (document.getElementById("datemax").value === "" || document.getElementById("datemin").value === "") {
        $("#dateTime").find("span").remove();
        $('<span class="Validform_checktip Validform_wrong"></span>').html("You must select the date").appendTo('#dateTime');
        return;
    }
    $("#dateTime").find("span").remove();
    uniqueClassName();
    }




    //get studentList and studentname list
function studentsListName() {
    studentsName=[];
    $.each(studentsList, function (index, singleStudent){
        studentsName.push(singleStudent["ID"] + ":" + singleStudent["StudentName"])
    });
   }



// display confirm information
function confirmST() {
    $("#confirmStudent").append("<thead><tr><th scope='col' colspan='9'>Confirm Student List</th></tr><tr><th width='40'>Student ID</th><th width='150'>Student Name</th><th width='90'>Student Email</th></tr></thead>");
    if (studentsList.length === 0) {
    }
    else { 
      for(var array in studentsList){
          $("#confirmStudent").append("<tr align='center'><td>" + studentsList[array]["StudentID"] + "</td><td>" + studentsList[array]["StudentName"] + "</td>" + "<td>" + studentsList[array]["StudentEmail"] + "</td></tr>");
      }
    }
  }

function confirmCS() {
    $("#confirmClass").append("<thead><tr><th scope='col' colspan='9'>Confirm Class Information</th></tr><tr><th width='40'>Class Name</th><th width='40'>Lesson Group</th><th width='150'>Study Start Time</th><th width='150'>Study End Time</th></tr></thead>");

	
    if (classInformation["ClassName"] === undefined) {
    }
    else {
        $("#confirmClass").append("<tr align='center'><td>" + classInformation["ClassName"] + "</td>"+"<td>" + classInformation["LessonGroup"] + "</td>"+ "<td>" + classInformation["StudyStartTime"] + "</td><td>" + classInformation["StudyEndTime"] + "</td></tr>");
    }
   }

function confirmLessonInfo() {
    $("#confirmLesson").append("<thead><tr><th scope='col' colspan='9'>Confirm Lesson List</th></tr><tr><th width='40'>Lesson ID</th><th width='40'>Lesson Name</th><th width='150'>Description</th></tr></thead>");
    if (lessonInformation.length === 0) {
    }
    else {
        for (var array in lessonInformation) {
            $("#confirmLesson").append("<tr align='center'><td>" + lessonInformation[array]['LessonID'] + "</td><td id=" + lessonInformation[array]['LessonID'] + " >" + lessonInformation[array]['LessonName'] + "</td><td>" + lessonInformation[array]['Description'] + "</td></tr>");
        }
    }
}

$('#confirmBT').click(function () {
    var flag = confirm("Are you sure all information is correct?");
    studentsListName();
    postStuName();
    putClassInfor();
    //if (flag === true) { location.replace(location.href); }
    
});


// instore all information to create a class
var classInformation = {};
var lessonInformation = [];
var studentsList = [];
var lessonObj;
var selectStud;
var studentsName;
var flag = 0;
var teacherName;
var TeacherEmail;
var count = 3;
var tabId = "step1";
var step = [true, false, false, false];
var nameMap = { "step1": "#classInfo", "step2": "#lessonInfo", "step3": "#studentList", "step4": "#confirm" };
var groupName;
var signForPut = false;   // equal false post lesson if equal true use put method


function lessonPost() {
    var method;
    var Url;
    if (signForPut == false) {
        method = "POST";
        Url = '/api/Classes';
    }
    else {
        method = "Put";
        Url = '/api/Classes/ModifyClassBasicInfo';
    }
    content = classInformation;
   

    $.ajax({

        url: Url,
        type: method,
        data: content,

    }).success(function (data) {
        console.log(".net Output:");
        console.log(data);
        if (data == true) {
            //alert(data);
        }
        else {
            //alert(data);
        }
        signForPut = true;
    });

}

function putLessonInfo() {
    var method = "PUT";
    content = classInformation;
    Url = '/api/Classes/ModifySelectedLessonsInfo';
    $.ajax({

        url: Url,
        type: method,
        data: content,

    }).success(function (data) {
        console.log(".net Output:");
        console.log(data);

    });
}

function putStudentInfo() {

    var method = "PUT";

    content = classInformation;

    // Url = '/api/MongoDB/' + email;
    Url = '/api/Classes/ModifyClassStudents';
    $.ajax({

        url: Url,
        type: method,
        data: content,

    }).success(function (data) {
        console.log(".net Output:");
        console.log(data);
        //alert(data);

    });
}

function putClassInfor() {
    var method = "PUT";
    content = classInformation;
    Url = '/api/Classes/ModifyUpdateClassInfo';
    $.ajax({

        url: Url,
        type: method,
        data: content,

    }).success(function (data) {
        console.log(data);    
    });
}


//post funtion upload studentNames
function postStuName() {
    var method = "POST";
    content = { "StudentsName": studentsName, "group": groupName, ClassName: classInformation["ClassName"]};
    method = "POST";
    Url = '/api/CreateClasses';

    $.ajax({

        url: Url,
        type: method,
        data: content,

    }).success(function (data) {
        console.log(".net Output:");
        console.log(data);
        if (data == true) {
            //location.replace(location.href);
        }
        else {
            $("#url").append("<td>" + data + "</td>");
            $("#displayUrl").show();
            $(".ideal-wrap").hide();
            $("#doneButton").show();
            $("#submitBtn").hide();
            //alert(data);
        }

    });

}


function uniqueClassName() {
    method = "GET";
    content = { "key": "getClassInfoByClassName", "searchKey": classInformation["ClassName"]};
    Url = '/api/Classes';
    $.ajax({

        url: Url,
        type: method,
        dataType: 'json',
        data: content,

    }).success(function (data) {
        if (data.length ===0||signForPut ===true) {
            $("#divClassname").find("span").remove();
            $("#dateTime").find("span").remove();
            lessonPost();
            $("#classInfo").hide();
            $("#lessonInfo").show();
            $("#step1").attr("class", "ideal-tabs-tab");
            $("#step2").attr("class", "ideal-tabs-tab ideal-tabs-tab-active");
            $("#lessonsTable thead").remove();
            $("#lessonsTable tr").remove();
            displayLessons();
            step[1] = true;
            tabId = "step2";
        }
        else {
            $("#divClassname").find("span").remove();
            $('<span class="Validform_checktip Validform_wrong"></span>').html("This class name already exist!").appendTo('#divClassname');
        }

        });

}


function isValidMail(email) {
    var patten = new RegExp(/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]+$/);
    return patten.test(email);
}

function openClassTab(obj, id) {
    Hui_admin_tab(obj);
}

$(document).ready(function () {
    var isLogin = localStorage.getItem('isLogin');
    var PersonInfoObj = localStorage.getItem('PersonInfo');
    var PersonInfo = JSON.parse(PersonInfoObj);
    var isEmptyObject = jQuery.isEmptyObject(PersonInfo);
    if (isEmptyObject == false) {
        TeacherEmail = PersonInfo.Email;
        $("#email").val(TeacherEmail);
        $('#email').attr('disabled', true);
        teacherName = PersonInfo.FirstName;
    }
   groupOption();
});

</script>
</body>
</html>